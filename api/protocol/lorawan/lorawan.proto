// Copyright Â© 2016 The Things Network
// Use of this source code is governed by the MIT license that can be found in the LICENSE file.

syntax = "proto3";

import "github.com/gogo/protobuf/gogoproto/gogo.proto";

package lorawan;

enum Modulation {
  LORA = 0;
  FSK  = 1;
}

message Metadata {
  Modulation  modulation   = 11;
  string      data_rate    = 12; // LoRa data rate - SF{spreadingfactor}BW{bandwidth}
  uint32      bit_rate     = 13; // FSK bit rate in bit/s
  string      coding_rate  = 14; // LoRa coding rate

  uint32      f_cnt = 15; // Store the full 32 bit FCnt
}

message TxConfiguration {
  Modulation  modulation   = 11;
  string      data_rate    = 12; // LoRa data rate - SF{spreadingfactor}BW{bandwidth}
  uint32      bit_rate     = 13; // FSK bit rate in bit/s
  string      coding_rate  = 14; // LoRa coding rate

  uint32      f_cnt = 15; // Store the full 32 bit FCnt
}

message ActivationMetadata {
  bytes app_eui    = 1 [(gogoproto.customtype) = "github.com/TheThingsNetwork/ttn/core/types.AppEUI"];
  bytes dev_eui    = 2 [(gogoproto.customtype) = "github.com/TheThingsNetwork/ttn/core/types.DevEUI"];
  bytes dev_addr   = 3 [(gogoproto.customtype) = "github.com/TheThingsNetwork/ttn/core/types.DevAddr"];
  bytes nwk_s_key  = 4 [(gogoproto.customtype) = "github.com/TheThingsNetwork/ttn/core/types.NwkSKey"];

  uint32 rx1_dr_offset    = 11;
  uint32 rx2_dr           = 12;
  uint32 rx_delay         = 13;
  repeated uint64 cf_list = 14;
}

message PHYPayload {
  MHdr       mhdr        = 1;
  MACPayload MAC_payload = 2;
  bytes      mic         = 3;
}

message MHdr {
  uint32 m_type = 1;
  uint32 major  = 2;
}

message MACPayload {
  FHdr   f_hdr       = 1;
  uint32 f_port      = 2;
  bytes  FRM_payload = 3;
}

message FHdr {
  bytes          dev_addr = 1 [(gogoproto.customtype) = "github.com/TheThingsNetwork/ttn/core/types.DevAddr"];
  FCtrl          f_ctrl   = 2;
  uint32         f_cnt    = 3;
  repeated bytes f_opts   = 4;
}

message FCtrl {
  bool  adr         = 1;
  bool  adr_ack_req = 2;
  bool  ack         = 3;
  bool  f_pending   = 4;
  bytes f_opts_len  = 5;
}

enum Region {
  EU_863_870 = 0;
  US_902_928 = 1;
  CN_779_787 = 2;
  EU_433     = 3;
  AU_915_928 = 4;
  CN_470_510 = 5;
}
